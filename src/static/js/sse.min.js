/**
 * SSE (Server-Sent Events) JavaScript library
 * Minimal implementation for HTMX integration
 */
(function() {
    'use strict';

    // SSE extension for HTMX
    htmx.defineExtension('sse', {
        init: function(api) {
            return {
                onEvent: function(name, evt) {
                    var parent = evt.target || evt.srcElement;
                    var target = parent.querySelector('[sse-connect]') || parent;
                    if (target) {
                        var eventSource = new EventSource(target.getAttribute('sse-connect'));
                        var closeTarget = target.getAttribute('sse-close');

                        if (closeTarget) {
                            htmx.on(closeTarget, 'htmx:beforeRequest', function() {
                                eventSource.close();
                            });
                        }

                        eventSource.onmessage = function(event) {
                            var data = JSON.parse(event.data);
                            if (data.event) {
                                htmx.trigger(target, data.event, data.data);
                            }
                        };

                        eventSource.onerror = function() {
                            eventSource.close();
                        };
                    }
                }
            };
        }
    });
})();